#  中间代码生成及目标代码生成模块设计报告

## 模块设计概述

本模块基于C++语言和LLVM框架实现，完成了中间代码生成及目标代码生成工作。

## 开发环境

- llvm版本 11.0
- g++版本 11.3.0 
- make版本 4.3
- ubuntu版本 22.04

## 模块实现说明

中间代码生成模块的基本实现思路为：语义分析自底向上对抽象语法树进行分析，在指定节点分析完成后，将调用中间代码生成模块，生成对应的LLVM IR中间代码。

- 针对不同抽象语法树结点，程序会生成不同中间代码，具体处理逻辑为：
- 这些抽象语法树结点大致可以划分为 表达式 语句 函数块（包括主程序和过程）
- 表达式部分，程序将根据表达式生成对应的中间代码计算语句
- 语句部分，程序将根据不同的语句类型，生成不同的基本块，通过基本间的跳转实现程序的分支、循环等功能。
- 函数、过程部分和语句部分类似，通过调用llvm API，生成对应的基本块，通过函数调用语句实现基本块的跳转，实现程序的函数调用与过程调用。
- 全局变量部分需要特殊生成，该部分，llvm IR只进行了声明，未进行定义，故在全局变量、常量定义后需要生成一个对应的.c文件，用于链接全局变量信息。
- 同时，针对read、write两个特殊IO过程，我单独编写IO.c文件用于链接操作。

目标代码生成模块的基本实现思路为：当中间代码生成完全结束，程序将初始化llvm，设置目标机。本次课程设计在Ubuntu-22.04上实现运行，目标机将被设置为x86_64-pc-linux-gnu。根据目标机初始化结果，获取对应的三元组结构、目标机架构。根据这些架构信息与LLVM IR中间代码，生成对应机器的汇编语言。
PS: 此处目标机设置可以进行修改 如修改成x86_64-pc-windows-gnu 即可生成windows系统下的目标代码。